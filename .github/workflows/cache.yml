name: Build Cache
on:
  push:
    branches: [main]
  schedule:
    - cron: '0 3 * * 1'  # Weekly Monday 3am
  workflow_dispatch:

jobs:
  build-cache:
    runs-on: ubuntu-latest
    container:
      image: ghcr.io/quantecon/quantecon:latest
    steps:
      - name: Checkout
        uses: actions/checkout@v5
      
      # Build HTML (full execution, no cache restore)
      - name: Build HTML
        id: build
        uses: quantecon/actions/build-lectures@v0
        with:
          source-dir: 'lectures'
          builder: 'html'
          upload-failure-reports: true
      
      # Save build cache for PR builds
      - name: Save Build Cache
        uses: actions/cache/save@v5
        with:
          path: _build
          key: build-${{ hashFiles('environment.yml') }}-${{ github.sha }}
      
      # Upload as artifact for visibility and cross-workflow access
      - name: Upload Build Cache Artifact
        uses: actions/upload-artifact@v4
        with:
          name: build-cache
          path: _build
          retention-days: 90
