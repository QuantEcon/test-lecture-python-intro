name: CI Preview
on: [pull_request]

jobs:
  preview:
    runs-on: ubuntu-latest
    container:
      image: ghcr.io/quantecon/quantecon:latest
    steps:
      - name: Checkout
        uses: actions/checkout@v5
      
      # Build HTML with build cache restore
      - name: Build HTML
        id: build
        uses: quantecon/actions/build-lectures@v0
        with:
          source-dir: 'lectures'
          builder: 'html'
          use-build-cache: true
          upload-failure-reports: true
      
      # Deploy preview to Netlify
      - name: Deploy to Netlify
        uses: quantecon/actions/deploy-netlify@v0
        with:
          publish-dir: ${{ steps.build.outputs.build-path }}
          netlify-auth-token: ${{ secrets.NETLIFY_AUTH_TOKEN }}
          netlify-site-id: ${{ secrets.NETLIFY_SITE_ID }}
